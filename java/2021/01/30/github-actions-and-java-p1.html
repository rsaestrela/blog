<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="index,follow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GitHub Actions &amp; Java - Part 1</title>
  <meta name="description" content="This is the first of a series of articles where I’m relating my experience with GitHub Actions, building and deploying Java microservices to production. In e...">
  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="canonical" href="https://estrela.me/blog/java/2021/01/30/github-actions-and-java-p1.html">
  <link rel="alternate" type="application/rss+xml" title="estrela.me * blog" href="https://estrela.me/blog/feed.xml">
  <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">
  <meta property="og:title" content="Raul Estrela">
  <meta property="og:site_name" content="Raul Estrela Blog">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://estrela.me/blog">
  <meta property="og:image" content="/assets/profile_image.png">
  <meta property="og:description" content="@rsaestrela personal website">
  <meta itemprop="name" content="Raul Estrela">
  <meta itemprop="description" content="@rsaestrela personal website">
  <meta itemprop="image" content="https://estrela.me/img/profile_image.png">
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-180685972-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-180685972-1');
</script>
</head>

  <body>
    <header class="header">
  <div class="wrapper">
    <a href="/blog/">
      <div class="profile-image"></div>
    </a>
    <div class="title">Thoughts written down, by Raul Estrela</div>
  </div>
</header>

    <header class="bar">
  <div class="wrapper">
    <span class="link-button">
      <a class="text-button" target="_blank" href="/blog/feed.xml">subscribe rss</a>
    </span>
    <span class="link-button">
      <a class="text-button" target="_blank" href="https://estrela.me">estrela.me</a>
    </span>
    <span class="link-button">
      <a class="text-button" target="_blank" href="https://github.com/rsaestrela">github</a>
    </span>
    <span class="link-button">
      <a class="text-button" target="_blank" href="https://www.linkedin.com/in/raulsilvaestrela/">linkedin</a>
    </span>
    <span class="link-button">
      <a class="text-button" target="_blank" href="https://dev.to/rsaestrela">dev.to</a>
    </span>
  </div>
</header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">GitHub Actions & Java - Part 1</h1>
    <p class="post-meta"><time datetime="2021-01-30T00:00:00+00:00" itemprop="datePublished">Jan 30, 2021</time></p>
  </header>
  <div class="post-content" itemprop="articleBody">
    <p>This is the first of a series of articles where I’m relating my experience with GitHub Actions, building and deploying Java microservices to production. In each article, I’m focusing on the key aspects of the framework and how we can take advantage of its features in the different phases that a Java CI/CD pipeline expects. The rest, you can easily find out in the <a href="https://docs.github.com/en/actions">official GitHub Actions documentation</a>.</p>

<h3 id="why-github-actions">Why GitHub Actions?</h3>

<p>As a Java developer coding and delivering software for a few years, I consider that working on a Continuous Integration and Deployment (CI/CD) environment is one of the most pleasant experiences in day-to-day work. With the right automation, repetitive and erroneous manual tasks can be avoided and everyone is able to focus more on what’s important. The workspace becomes much more efficient, clever and an exciting place to be.</p>

<p>Developing and maintaining all this magic is not usually at first. I’ve worked with a few CI/CD systems such as Jenkins, Bamboo (and more recently with GitLab), and I always felt a big gap between the required core skills for our day-to-day tasks and the ones to deal with these systems. The industry that cultivated for so long the <em>DevOps</em> concept, quickly evolved to a <em>NoOps</em> standard that apparently became to stay.</p>

<p>I always enjoyed to build CI/CD pipelines - playing with Jenkins back and forward, configuring steps in jobs, that called other jobs, and with some shell script and tools/plugins on top, something supposed to happen at the end, usually happened. A few months ago, I had a job in hand to set up a CI pipeline for a few projects where Jenkins was not an option. These projects were hosted on GitHub and the first thing that came to my mind was to use Travis or CircleCI (from my experience in open-source projects). Someone told that we could try GitHub Actions. After reading the docs and giving a try, I just realized  - Shit, finally a decent <em>NoOps</em> solution for every developer. If the same is happening to you, have a look on this article from GitHub on how to <a href="https://docs.github.com/en/actions/learn-github-actions/migrating-from-jenkins-to-github-actions">Migrate from Jenkins to GitHub Actions</a>.</p>

<p>In the next sections I’ll explain how to build a Java project that has a JAR artifact as an outcome.</p>

<h3 id="setup--build">Setup &amp; Build</h3>

<p>First things first. GitHub Actions is a decentralized system - this means that in opposition to systems like Jenkins that all the configuration is in a single place, with GitHub Actions all the configuration will be hosted in the project repository. This doesn’t sound something new, but I wouldn’t expect anything else nowadays where cross-functional teams own projects and are responsible for the full development life-cycle.</p>

<p>In GitHub Actions, regular CI <em>jobs</em> are called <code class="highlighter-rouge">workflows</code> that are triggered by <code class="highlighter-rouge">events</code> and contain <code class="highlighter-rouge">jobs</code> . A job can define multiple <code class="highlighter-rouge">steps</code> that run <strong>Actions</strong>. Simple, right? For more information on how to get started, check the <a href="https://docs.github.com/en/actions/quickstart">official documentation</a>.</p>

<p>To demonstrate some of the functionalities of GitHub Actions I just developed a <a href="https://github.com/rsaestrela/vertx-java-ms">nonsense Java microservice</a> with <a href="https://vertx.io/">Vert.x</a> (it could have been with Spring or anything else).  The only important points for now is that this service is built with Maven, uses a PostgreSQL database and runs Flyway migrations.</p>

<h4 id="workflow">Workflow</h4>

<p>This is the workflow created to build the project when there’s a push branch <code class="highlighter-rouge">main</code>. Additionally, GitHub Actions allows us to define different ways to trigger workflows. One of them is <code class="highlighter-rouge">workflow_dispatch</code>. This item was left empty just to allow triggering the job <a href="https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow">manually</a> without any parameter. There are multiple ways of triggering workflows being the <code class="highlighter-rouge">workflow_dispatch</code>or <code class="highlighter-rouge">repository_dispatch</code> (not included in this article) probably the most complex but interesting ones. For more information on this topic check the <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows">official documentation</a>.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">name</span><span class="pi">:</span> <span class="s">build-main</span>
<span class="s">on</span><span class="pi">:</span>
  <span class="s">push</span><span class="pi">:</span>
    <span class="s">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">main</span>
    <span class="s">workflow_dispatch</span><span class="pi">:</span>
<span class="s">jobs</span><span class="pi">:</span>
  <span class="s">build</span><span class="pi">:</span>
    <span class="s">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="s">services</span><span class="pi">:</span>
      <span class="s">postgres</span><span class="pi">:</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">postgres</span>
        <span class="s">env</span><span class="pi">:</span>
          <span class="s">POSTGRES_DB</span><span class="pi">:</span> <span class="s">vertxbroker</span>
          <span class="s">POSTGRES_USER</span><span class="pi">:</span> <span class="s">admin</span>
          <span class="s">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">admin</span>
        <span class="s">options</span><span class="pi">:</span> <span class="pi">&gt;-</span>
          <span class="no">--health-cmd pg_isready</span>
          <span class="no">--health-interval 10s</span>
          <span class="no">--health-timeout 5s</span>
          <span class="no">--health-retries 5</span>
        <span class="no">ports:</span>
          <span class="no">- 5455:5432</span>
    <span class="s">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="s">uses</span><span class="pi">:</span> <span class="s">actions/setup-java@v1</span>
        <span class="s">with</span><span class="pi">:</span>
          <span class="s">java-version</span><span class="pi">:</span> <span class="s">11</span>
          <span class="s">java-package</span><span class="pi">:</span> <span class="s">jdk</span>
          <span class="s">architecture</span><span class="pi">:</span> <span class="s">x64</span>
      <span class="pi">-</span> <span class="s">id</span><span class="pi">:</span> <span class="s">build</span>
        <span class="s">run</span><span class="pi">:</span> <span class="s">mvn verify</span>
</code></pre>
</div>

<h4 id="setup-dependencies">Setup Dependencies</h4>

<p>As mentioned before, workflows are simply containers of jobs. Jobs are virtually executed in an OS hosted in a… container. A job must define a <a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions?query=runs-on#jobsjob_idruns-on">runs-on</a> configuration that specifies the OS used in this instance and may specify a list of <a href="https://docs.github.com/es/actions/guides/about-service-containers">service containers</a> - services that will be installed in the system. In this project, a <code class="highlighter-rouge">postgres</code> service was defined to spin a PostgreSQL database necessary to build the project (and eventually execute integration tests using it).  There are a few different types of service containers <a href="https://github.com/actions/example-services">available</a> for these purposes.</p>

<h4 id="just-build-it">Just build it!</h4>

<p>With all the dependencies set, only 3 <code class="highlighter-rouge">steps</code> must be defined within this job to build the project. This is where things get interesting. Actions aren’t just triggers developed by GitHub. Everyone in GitHub (including yourself) can build actions, which means that you can find an action for almost everything (<a href="https://youtu.be/gwZ81gJRSuQ?t=72">just keep it simple</a>). A GitHub Action is specified to be executed in each step:</p>

<ul>
  <li>actions/checkout - gets the the Git repository</li>
  <li>actions/setup-java - installs JDK 11 for x64 and a few Java based tools, like Maven</li>
  <li>custom action <strong>build</strong> - runs whatever we want. In this case, it’s just triggering a Maven execution.</li>
</ul>

<p>And that’s it for now. After running <code class="highlighter-rouge">maven verify</code> a JAR binary should be built and made available in the <em>target</em> folder.</p>

<p>Without having to set up any CI tool or to master any GUI / complex DevOps configuration setup, GitHub gives <em>ootb</em> all this functionality in an extensible and free to use framework that in my opinion (and thanks to GitHub popularity) will set a new standard in the industry and it will reinforce even more the brand. I don’t think that Jenkins or any other powerful  CI/CD platform will be abandoned sooner, but if the Git product I’m adopting already gives me this functionality, why should I care about adding more tools and complexity to an CI/CD environment that should be easy to understand and maintain? At this stage, this might sound an overrated opinion about GitHub Actions - but believe me, as I’ll show you in the next articles or this series, GitHub seems able to cover almost all the functionalities needed in a CI/CD system, at least for the most common use cases.</p>

<p>All the source code presented can be found in this <a href="https://github.com/rsaestrela/vertx-java-ms">GitHub repository</a>.</p>

  </div>
  

</article>

      </div>
    </div>
    <footer class="site-footer">
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col">
        <p class="copyright">All rights reserved © Raul Estrela 2021</p>
      </div>
    </div>
  </div>
</footer>

  </body>
</html>
